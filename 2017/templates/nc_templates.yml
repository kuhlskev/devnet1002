---

xml_template: |
            <config xmlns:xc="urn:ietf:params:xml:ns:netconf:base:1.0">
              <native xmlns="http://cisco.com/ns/yang/Cisco-IOS-XE-native" xmlns:nc="urn:ietf:params:xml:ns:netconf:base:1.0">
                <ntp>
                  <server xmlns="http://cisco.com/ns/yang/Cisco-IOS-XE-ntp">
                    <server-list>
                      <ip-address>{{ntp3}}</ip-address>
                    </server-list>
                  </server>
                </ntp>
              </native>
            </config>

IWAN_QoS_template: |
  <config xmlns:ns0="http://cisco.com/ns/yang/ned/ios">
    <ns0:native>
      <ns0:interface>
        <ns0:GigabitEthernet annotation="! interface GigabitEthernet$WAN_INTERFACE_ID">
          <ns0:name>{{ IWAN_Hub_QoS_Per_TunnelGrouping.WAN_INTERFACE_ID | string() }}</ns0:name>
          <ns0:bandwidth>
            <ns0:kilobits annotation="!bandwidth $WAN_BANDWIDTH">{{ IWAN_Hub_QoS_Per_TunnelGrouping.WAN_BANDWIDTH | string() }}</ns0:kilobits>
          </ns0:bandwidth>
          <ns0:service-policy>
            <ns0:output>POLICY-TRANSPORT-1-SHAPE-ONLY</ns0:output>
          </ns0:service-policy>
        </ns0:GigabitEthernet>
        <ns0:Tunnel annotation="!interface Tunnel$TUNNEL_NUM">
          <ns0:name>{{ IWAN_Hub_QoS_Per_TunnelGrouping.TUNNEL_NUM | string() }}</ns0:name>
          <ns0:ip>
            <ns0:nhrp>
              <ns0:map>
                <ns0:group>
                  <ns0:name>RS-GROUP-100MBPS</ns0:name>
                  <ns0:service-policy>
                    <ns0:output>RS-GROUP-100MBPS-POLICY</ns0:output>
                  </ns0:service-policy>
                </ns0:group>
                <ns0:group>
                  <ns0:name>RS-GROUP-10MBPS</ns0:name>
                  <ns0:service-policy>
                    <ns0:output>RS-GROUP-10MBPS-POLICY</ns0:output>
                  </ns0:service-policy>
                </ns0:group>
                <ns0:group>
                  <ns0:name>RS-GROUP-200MBPS</ns0:name>
                  <ns0:service-policy>
                    <ns0:output>RS-GROUP-200MBPS-POLICY</ns0:output>
                  </ns0:service-policy>
                </ns0:group>
                <ns0:group>
                  <ns0:name>RS-GROUP-20MBPS</ns0:name>
                  <ns0:service-policy>
                    <ns0:output>RS-GROUP-20MBPS-POLICY</ns0:output>
                  </ns0:service-policy>
                </ns0:group>
                <ns0:group>
                  <ns0:name>RS-GROUP-300MBPS</ns0:name>
                  <ns0:service-policy>
                    <ns0:output>RS-GROUP-300MBPS-POLICY</ns0:output>
                  </ns0:service-policy>
                </ns0:group>
                <ns0:group>
                  <ns0:name>RS-GROUP-30MBPS</ns0:name>
                  <ns0:service-policy>
                    <ns0:output>RS-GROUP-30MBPS-POLICY</ns0:output>
                  </ns0:service-policy>
                </ns0:group>
                <ns0:group>
                  <ns0:name>RS-GROUP-4G</ns0:name>
                  <ns0:service-policy>
                    <ns0:output>!!!@</ns0:output>
                  </ns0:service-policy>
                </ns0:group>
                <ns0:group>
                  <ns0:name>RS-GROUP-50MBPS</ns0:name>
                  <ns0:service-policy>
                    <ns0:output>RS-GROUP-50MBPS-POLICY</ns0:output>
                  </ns0:service-policy>
                </ns0:group>
              </ns0:map>
            </ns0:nhrp>
          </ns0:ip>
        </ns0:Tunnel>
      </ns0:interface>
      <ns0:class-map>
        <ns0:name>CALL-SIGNALING</ns0:name>
        <ns0:prematch>match-any</ns0:prematch>
        <ns0:match>
          <ns0:dscp>cs3</ns0:dscp>
        </ns0:match>
      </ns0:class-map>
      <ns0:class-map>
        <ns0:name>CRITICAL-DATA</ns0:name>
        <ns0:prematch>match-any</ns0:prematch>
        <ns0:match>
          <ns0:dscp>af11</ns0:dscp>
          <ns0:dscp>af12</ns0:dscp>
          <ns0:dscp>af13</ns0:dscp>
          <ns0:dscp>cs2</ns0:dscp>
          <ns0:dscp>af21</ns0:dscp>
          <ns0:dscp>af22</ns0:dscp>
          <ns0:dscp>af23</ns0:dscp>
        </ns0:match>
      </ns0:class-map>
      <ns0:class-map>
        <ns0:name>INTERACTIVE-VIDEO</ns0:name>
        <ns0:prematch>match-any</ns0:prematch>
        <ns0:match>
          <ns0:dscp>cs4</ns0:dscp>
          <ns0:dscp>af41</ns0:dscp>
          <ns0:dscp>af42</ns0:dscp>
          <ns0:dscp>af43</ns0:dscp>
        </ns0:match>
      </ns0:class-map>
      <ns0:class-map>
        <ns0:name>NET-CTRL</ns0:name>
        <ns0:prematch>match-any</ns0:prematch>
        <ns0:match>
          <ns0:dscp>cs6</ns0:dscp>
        </ns0:match>
      </ns0:class-map>
      <ns0:class-map>
        <ns0:name>SCAVENGER</ns0:name>
        <ns0:prematch>match-any</ns0:prematch>
        <ns0:match>
          <ns0:dscp>cs1</ns0:dscp>
        </ns0:match>
      </ns0:class-map>
      <ns0:class-map annotation="!! MACRO name CVD_IWAN_Hub_QoS_Per_Tunnel !! Platform: Routers, OS: 15.5 !! Preconditions: !! Desc: Best practice configuration for IWAN Hub QoS for an 6 class QoS WAN policy model. !! Usage: clean !! Vars: Only use &quot;_&quot; special characters in variable names !! $WAN_SHAPE_AVERAGE: ; The bandwidth of the WAN link in bits per second. !! $WAN_BANDWIDTH: ;  The bandwidth of the WAN link in kilobits per second. !! $TUNNEL_NUM: ; The tunnel number for which the QoS Per-Tunnel Policies will be applied. !! $WAN_INTERFACE_ID: ; The physical WAN interface ID, i.e. 0, 0/1, etc. !!">
        <ns0:name>{{ IWAN_Hub_QoS_Per_TunnelGrouping.WAN_INTERFACE_ID | string() }}</ns0:name>
        <ns0:prematch>match-any</ns0:prematch>
        <ns0:match>
          <ns0:dscp>af31</ns0:dscp>
          <ns0:dscp>af32</ns0:dscp>
          <ns0:dscp>af33</ns0:dscp>
          <ns0:dscp>cs5</ns0:dscp>
        </ns0:match>
      </ns0:class-map>
      <ns0:class-map>
        <ns0:name>VOICE</ns0:name>
        <ns0:prematch>match-any</ns0:prematch>
        <ns0:match>
          <ns0:dscp>ef</ns0:dscp>
        </ns0:match>
      </ns0:class-map>
      <ns0:policy-map>
        <ns0:name>POLICY-TRANSPORT-1-SHAPE-ONLY</ns0:name>
        <ns0:class>
          <ns0:name>class-default</ns0:name>
          <ns0:action-list>
            <ns0:action-type>shape</ns0:action-type>
            <ns0:shape>
              <ns0:average>
                <ns0:bit-rate annotation="!  shape average $WAN_SHAPE_AVERAGE">{{ IWAN_Hub_QoS_Per_TunnelGrouping.WAN_SHAPE_AVERAGE | string() }}</ns0:bit-rate>
              </ns0:average>
            </ns0:shape>
          </ns0:action-list>
        </ns0:class>
      </ns0:policy-map>
      <ns0:policy-map>
        <ns0:name>RS-GROUP-100MBPS-POLICY</ns0:name>
        <ns0:class>
          <ns0:name>class-default</ns0:name>
          <ns0:action-list>
            <ns0:action-type>shape</ns0:action-type>
            <ns0:shape>
              <ns0:average>
                <ns0:bit-rate>100000000</ns0:bit-rate>
              </ns0:average>
            </ns0:shape>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>bandwidth</ns0:action-type>
            <ns0:bandwidth>
              <ns0:remaining>
                <ns0:ratio>100</ns0:ratio>
              </ns0:remaining>
            </ns0:bandwidth>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>service-policy</ns0:action-type>
            <ns0:service-policy>WAN</ns0:service-policy>
          </ns0:action-list>
        </ns0:class>
      </ns0:policy-map>
      <ns0:policy-map>
        <ns0:name>RS-GROUP-10MBPS-POLICY</ns0:name>
        <ns0:class>
          <ns0:name>class-default</ns0:name>
          <ns0:action-list>
            <ns0:action-type>shape</ns0:action-type>
            <ns0:shape>
              <ns0:average>
                <ns0:bit-rate>10000000</ns0:bit-rate>
              </ns0:average>
            </ns0:shape>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>bandwidth</ns0:action-type>
            <ns0:bandwidth>
              <ns0:remaining>
                <ns0:ratio>10</ns0:ratio>
              </ns0:remaining>
            </ns0:bandwidth>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>service-policy</ns0:action-type>
            <ns0:service-policy>WAN</ns0:service-policy>
          </ns0:action-list>
        </ns0:class>
      </ns0:policy-map>
      <ns0:policy-map>
        <ns0:name>RS-GROUP-200MBPS-POLICY</ns0:name>
        <ns0:class>
          <ns0:name>class-default</ns0:name>
          <ns0:action-list>
            <ns0:action-type>shape</ns0:action-type>
            <ns0:shape>
              <ns0:average>
                <ns0:bit-rate>200000000</ns0:bit-rate>
              </ns0:average>
            </ns0:shape>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>bandwidth</ns0:action-type>
            <ns0:bandwidth>
              <ns0:remaining>
                <ns0:ratio>200</ns0:ratio>
              </ns0:remaining>
            </ns0:bandwidth>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>service-policy</ns0:action-type>
            <ns0:service-policy>WAN</ns0:service-policy>
          </ns0:action-list>
        </ns0:class>
      </ns0:policy-map>
      <ns0:policy-map>
        <ns0:name>RS-GROUP-20MBPS-POLICY</ns0:name>
        <ns0:class>
          <ns0:name>class-default</ns0:name>
          <ns0:action-list>
            <ns0:action-type>shape</ns0:action-type>
            <ns0:shape>
              <ns0:average>
                <ns0:bit-rate>20000000</ns0:bit-rate>
              </ns0:average>
            </ns0:shape>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>bandwidth</ns0:action-type>
            <ns0:bandwidth>
              <ns0:remaining>
                <ns0:ratio>20</ns0:ratio>
              </ns0:remaining>
            </ns0:bandwidth>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>service-policy</ns0:action-type>
            <ns0:service-policy>WAN</ns0:service-policy>
          </ns0:action-list>
        </ns0:class>
      </ns0:policy-map>
      <ns0:policy-map>
        <ns0:name>RS-GROUP-300MBPS-POLICY</ns0:name>
        <ns0:class>
          <ns0:name>class-default</ns0:name>
          <ns0:action-list>
            <ns0:action-type>shape</ns0:action-type>
            <ns0:shape>
              <ns0:average>
                <ns0:bit-rate>300000000</ns0:bit-rate>
              </ns0:average>
            </ns0:shape>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>bandwidth</ns0:action-type>
            <ns0:bandwidth>
              <ns0:remaining>
                <ns0:ratio>300</ns0:ratio>
              </ns0:remaining>
            </ns0:bandwidth>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>service-policy</ns0:action-type>
            <ns0:service-policy>WAN</ns0:service-policy>
          </ns0:action-list>
        </ns0:class>
      </ns0:policy-map>
      <ns0:policy-map>
        <ns0:name>RS-GROUP-30MBPS-POLICY</ns0:name>
        <ns0:class>
          <ns0:name>class-default</ns0:name>
          <ns0:action-list>
            <ns0:action-type>shape</ns0:action-type>
            <ns0:shape>
              <ns0:average>
                <ns0:bit-rate>30000000</ns0:bit-rate>
              </ns0:average>
            </ns0:shape>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>bandwidth</ns0:action-type>
            <ns0:bandwidth>
              <ns0:remaining>
                <ns0:ratio>30</ns0:ratio>
              </ns0:remaining>
            </ns0:bandwidth>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>service-policy</ns0:action-type>
            <ns0:service-policy>WAN</ns0:service-policy>
          </ns0:action-list>
        </ns0:class>
      </ns0:policy-map>
      <ns0:policy-map>
        <ns0:name>RS-GROUP-4G-POLICY</ns0:name>
        <ns0:class>
          <ns0:name>class-default</ns0:name>
          <ns0:action-list>
            <ns0:action-type>shape</ns0:action-type>
            <ns0:shape>
              <ns0:average>
                <ns0:bit-rate>8000000</ns0:bit-rate>
              </ns0:average>
            </ns0:shape>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>bandwidth</ns0:action-type>
            <ns0:bandwidth>
              <ns0:remaining>
                <ns0:ratio>8</ns0:ratio>
              </ns0:remaining>
            </ns0:bandwidth>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>service-policy</ns0:action-type>
            <ns0:service-policy>WAN</ns0:service-policy>
          </ns0:action-list>
        </ns0:class>
      </ns0:policy-map>
      <ns0:policy-map>
        <ns0:name>RS-GROUP-50MBPS-POLICY</ns0:name>
        <ns0:class>
          <ns0:name>class-default</ns0:name>
          <ns0:action-list>
            <ns0:action-type>shape</ns0:action-type>
            <ns0:shape>
              <ns0:average>
                <ns0:bit-rate>50000000</ns0:bit-rate>
              </ns0:average>
            </ns0:shape>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>bandwidth</ns0:action-type>
            <ns0:bandwidth>
              <ns0:remaining>
                <ns0:ratio>50</ns0:ratio>
              </ns0:remaining>
            </ns0:bandwidth>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>service-policy</ns0:action-type>
            <ns0:service-policy>WAN</ns0:service-policy>
          </ns0:action-list>
        </ns0:class>
      </ns0:policy-map>
      <ns0:policy-map>
        <ns0:name>WAN</ns0:name>
        <ns0:class>
          <ns0:name>CALL-SIGNALING</ns0:name>
          <ns0:action-list>
            <ns0:action-type>bandwidth</ns0:action-type>
            <ns0:bandwidth>
              <ns0:remaining>
                <ns0:percent>4</ns0:percent>
              </ns0:remaining>
            </ns0:bandwidth>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>set</ns0:action-type>
            <ns0:set>
              <ns0:dscp>
                <ns0:tunnel />
                <ns0:dscp-val>af21</ns0:dscp-val>
              </ns0:dscp>
            </ns0:set>
          </ns0:action-list>
        </ns0:class>
        <ns0:class>
          <ns0:name>CRITICAL-DATA</ns0:name>
          <ns0:action-list>
            <ns0:action-type>bandwidth</ns0:action-type>
            <ns0:bandwidth>
              <ns0:remaining>
                <ns0:percent>25</ns0:percent>
              </ns0:remaining>
            </ns0:bandwidth>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>random-detect</ns0:action-type>
            <ns0:random-detect>
              <ns0:dscp-based />
            </ns0:random-detect>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>set</ns0:action-type>
            <ns0:set>
              <ns0:dscp>
                <ns0:tunnel />
                <ns0:dscp-val>af21</ns0:dscp-val>
              </ns0:dscp>
            </ns0:set>
          </ns0:action-list>
        </ns0:class>
        <ns0:class>
          <ns0:name>INTERACTIVE-VIDEO</ns0:name>
          <ns0:action-list>
            <ns0:action-type>bandwidth</ns0:action-type>
            <ns0:bandwidth>
              <ns0:remaining>
                <ns0:percent>30</ns0:percent>
              </ns0:remaining>
            </ns0:bandwidth>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>random-detect</ns0:action-type>
            <ns0:random-detect>
              <ns0:dscp-based />
            </ns0:random-detect>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>set</ns0:action-type>
            <ns0:set>
              <ns0:dscp>
                <ns0:tunnel />
                <ns0:dscp-val>af41</ns0:dscp-val>
              </ns0:dscp>
            </ns0:set>
          </ns0:action-list>
        </ns0:class>
        <ns0:class>
          <ns0:name>NET-CTRL</ns0:name>
          <ns0:action-list>
            <ns0:action-type>bandwidth</ns0:action-type>
            <ns0:bandwidth>
              <ns0:remaining>
                <ns0:percent>5</ns0:percent>
              </ns0:remaining>
            </ns0:bandwidth>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>set</ns0:action-type>
            <ns0:set>
              <ns0:dscp>
                <ns0:tunnel />
                <ns0:dscp-val>cs6</ns0:dscp-val>
              </ns0:dscp>
            </ns0:set>
          </ns0:action-list>
        </ns0:class>
        <ns0:class>
          <ns0:name>SCAVENGER</ns0:name>
          <ns0:action-list>
            <ns0:action-type>bandwidth</ns0:action-type>
            <ns0:bandwidth>
              <ns0:remaining>
                <ns0:percent>1</ns0:percent>
              </ns0:remaining>
            </ns0:bandwidth>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>set</ns0:action-type>
            <ns0:set>
              <ns0:dscp>
                <ns0:tunnel />
                <ns0:dscp-val>af11</ns0:dscp-val>
              </ns0:dscp>
            </ns0:set>
          </ns0:action-list>
        </ns0:class>
        <ns0:class>
          <ns0:name>STREAMING-VIDEO</ns0:name>
          <ns0:action-list>
            <ns0:action-type>bandwidth</ns0:action-type>
            <ns0:bandwidth>
              <ns0:remaining>
                <ns0:percent>10</ns0:percent>
              </ns0:remaining>
            </ns0:bandwidth>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>random-detect</ns0:action-type>
            <ns0:random-detect>
              <ns0:dscp-based />
            </ns0:random-detect>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>set</ns0:action-type>
            <ns0:set>
              <ns0:dscp>
                <ns0:tunnel />
                <ns0:dscp-val>af31</ns0:dscp-val>
              </ns0:dscp>
            </ns0:set>
          </ns0:action-list>
        </ns0:class>
        <ns0:class>
          <ns0:name>VOICE</ns0:name>
          <ns0:action-list>
            <ns0:action-type>priority</ns0:action-type>
            <ns0:priority>
              <ns0:level>1</ns0:level>
            </ns0:priority>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>police</ns0:action-type>
            <ns0:police-cir-percent>
              <ns0:police>
                <ns0:cir>
                  <ns0:percent>
                    <ns0:percentage>10</ns0:percentage>
                  </ns0:percent>
                </ns0:cir>
              </ns0:police>
            </ns0:police-cir-percent>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>set</ns0:action-type>
            <ns0:set>
              <ns0:dscp>
                <ns0:tunnel />
                <ns0:dscp-val>ef</ns0:dscp-val>
              </ns0:dscp>
            </ns0:set>
          </ns0:action-list>
        </ns0:class>
        <ns0:class>
          <ns0:name>class-default</ns0:name>
          <ns0:action-list>
            <ns0:action-type>bandwidth</ns0:action-type>
            <ns0:bandwidth>
              <ns0:remaining>
                <ns0:percent>25</ns0:percent>
              </ns0:remaining>
            </ns0:bandwidth>
          </ns0:action-list>
          <ns0:action-list>
            <ns0:action-type>random-detect</ns0:action-type>
          </ns0:action-list>
        </ns0:class>
      </ns0:policy-map>
    </ns0:native>
  </config>